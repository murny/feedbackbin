/* ==========================================================================
   Button Component

   Usage:
     <button class="btn">Default</button>
     <button class="btn btn--primary">Primary</button>
     <button class="btn btn--outline btn--sm">Small Outline</button>
     <button class="btn btn--icon" aria-label="Settings"><svg>...</svg></button>

   Variants: btn--primary, btn--secondary, btn--outline, btn--ghost, btn--link, btn--destructive
   Sizes: btn--sm, btn--lg, btn--icon
   ========================================================================== */

@layer components {
  /* Base
  /* ------------------------------------------------------------------------ */

  .btn {
    /* Component API - these variables can be customized by variants */
    --btn-height: 2.25rem;
    --btn-padding-inline: 1rem;
    --btn-padding-block: 0.5rem;
    --btn-gap: 0.5rem;
    --btn-font-size: var(--text-sm);
    --btn-font-weight: var(--font-medium);
    --btn-radius: var(--radius-md);
    --btn-background: var(--color-primary);
    --btn-color: var(--color-primary-foreground);
    --btn-border-color: transparent;
    --btn-shadow: var(--shadow-xs);
    --btn-hover-brightness: 0.9;
    --btn-icon-size: 1rem;

    /* Structure */
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: var(--btn-gap);
    block-size: var(--btn-height);
    padding-inline: var(--btn-padding-inline);
    padding-block: var(--btn-padding-block);

    /* Appearance */
    background-color: var(--btn-background);
    color: var(--btn-color);
    border: 1px solid var(--btn-border-color);
    border-radius: var(--btn-radius);
    box-shadow: var(--btn-shadow);

    /* Typography */
    font-size: var(--btn-font-size);
    font-weight: var(--btn-font-weight);
    line-height: var(--leading-none);
    white-space: nowrap;

    /* Behavior */
    cursor: pointer;
    user-select: none;
    flex-shrink: 0;

    /* Transitions */
    transition: var(--duration-fast) var(--ease-out);
    transition-property: background-color, border-color, box-shadow, color, filter, opacity;

    /* Icon sizing */
    svg,
    .icon {
      inline-size: var(--btn-icon-size);
      block-size: var(--btn-icon-size);
      flex-shrink: 0;
      pointer-events: none;
    }

    /* Hover state */
    @media (any-hover: hover) {
      &:hover:not([disabled]) {
        filter: brightness(var(--btn-hover-brightness));
      }
    }

    /* Dark mode hover adjustment */
    html[data-theme="dark"] & {
      --btn-hover-brightness: 1.15;
    }

    @media (prefers-color-scheme: dark) {
      html:not([data-theme]) & {
        --btn-hover-brightness: 1.15;
      }
    }

    /* Focus state */
    &:focus-visible {
      outline: var(--focus-ring-width) solid var(--focus-ring-color);
      outline-offset: var(--focus-ring-offset);
    }

    /* Active/pressed state */
    &:active:not([disabled]),
    &[aria-pressed="true"] {
      filter: brightness(calc(var(--btn-hover-brightness) - 0.05));
    }

    /* Disabled state */
    &[disabled],
    &:disabled {
      cursor: not-allowed;
      opacity: 0.5;
      pointer-events: none;
    }

    /* When button contains only an icon, adjust padding */
    &:has(> svg:only-child),
    &:has(> .icon:only-child) {
      --btn-padding-inline: 0.75rem;
    }
  }

  /* Variant: Primary (default, explicitly named for clarity)
  /* ------------------------------------------------------------------------ */

  .btn--primary {
    --btn-background: var(--color-primary);
    --btn-color: var(--color-primary-foreground);
  }

  /* Variant: Secondary
  /* ------------------------------------------------------------------------ */

  .btn--secondary {
    --btn-background: var(--color-secondary);
    --btn-color: var(--color-secondary-foreground);

    html[data-theme="dark"] &,
    html:not([data-theme]) & {
      @media (prefers-color-scheme: dark) {
        --btn-hover-brightness: 1.25;
      }
    }
  }

  /* Variant: Outline
  /* ------------------------------------------------------------------------ */

  .btn--outline {
    --btn-background: var(--color-canvas);
    --btn-color: var(--color-ink);
    --btn-border-color: var(--color-border);

    &:hover:not([disabled]) {
      --btn-background: var(--color-accent);
      --btn-color: var(--color-accent-foreground);
    }

    html[data-theme="dark"] & {
      --btn-background: var(--color-input);
      --btn-border-color: var(--color-input);
    }

    @media (prefers-color-scheme: dark) {
      html:not([data-theme]) & {
        --btn-background: var(--color-input);
        --btn-border-color: var(--color-input);
      }
    }
  }

  /* Variant: Ghost
  /* ------------------------------------------------------------------------ */

  .btn--ghost {
    --btn-background: transparent;
    --btn-color: var(--color-ink);
    --btn-border-color: transparent;
    --btn-shadow: none;

    &:hover:not([disabled]) {
      --btn-background: var(--color-accent);
      --btn-color: var(--color-accent-foreground);
      filter: none;
    }

    html[data-theme="dark"] &:hover:not([disabled]) {
      --btn-background: var(--color-accent);
    }

    @media (prefers-color-scheme: dark) {
      html:not([data-theme]) &:hover:not([disabled]) {
        --btn-background: var(--color-accent);
      }
    }
  }

  /* Variant: Link
  /* ------------------------------------------------------------------------ */

  .btn--link {
    --btn-background: transparent;
    --btn-color: var(--color-primary);
    --btn-border-color: transparent;
    --btn-shadow: none;
    --btn-height: auto;
    --btn-padding-inline: 0;
    --btn-padding-block: 0;

    text-underline-offset: 4px;

    &:hover:not([disabled]) {
      text-decoration: underline;
      filter: none;
    }
  }

  /* Variant: Destructive
  /* ------------------------------------------------------------------------ */

  .btn--destructive {
    --btn-background: var(--color-destructive);
    --btn-color: var(--color-destructive-foreground);
    --focus-ring-color: var(--color-destructive);

    html[data-theme="dark"] & {
      --btn-background: oklch(from var(--color-destructive) l c h / 60%);
    }

    @media (prefers-color-scheme: dark) {
      html:not([data-theme]) & {
        --btn-background: oklch(from var(--color-destructive) l c h / 60%);
      }
    }
  }

  /* Size: Small
  /* ------------------------------------------------------------------------ */

  .btn--sm {
    --btn-height: 2rem;
    --btn-padding-inline: 0.75rem;
    --btn-gap: 0.375rem;
    --btn-icon-size: 0.875rem;
  }

  /* Size: Large
  /* ------------------------------------------------------------------------ */

  .btn--lg {
    --btn-height: 2.5rem;
    --btn-padding-inline: 1.5rem;
    --btn-gap: 0.5rem;
    --btn-icon-size: 1.125rem;
  }

  /* Size: Icon (square button)
  /* ------------------------------------------------------------------------ */

  .btn--icon {
    --btn-padding-inline: 0;
    --btn-padding-block: 0;

    aspect-ratio: 1;
    inline-size: var(--btn-height);

    /* Icon-only buttons should have larger icons */
    --btn-icon-size: 1.125rem;

    &.btn--sm {
      --btn-icon-size: 1rem;
    }

    &.btn--lg {
      --btn-icon-size: 1.25rem;
    }
  }

  /* Button Groups
  /* ------------------------------------------------------------------------ */

  .btn-group {
    display: inline-flex;

    .btn {
      --btn-radius: 0;

      &:first-child {
        border-start-start-radius: var(--radius-md);
        border-end-start-radius: var(--radius-md);
      }

      &:last-child {
        border-start-end-radius: var(--radius-md);
        border-end-end-radius: var(--radius-md);
      }

      &:not(:first-child) {
        margin-inline-start: -1px;
      }
    }
  }

  /* Loading State
  /* ------------------------------------------------------------------------ */

  .btn--loading {
    position: relative;
    pointer-events: none;

    /* Hide content */
    > * {
      visibility: hidden;
    }

    /* Spinner */
    &::after {
      content: "";
      position: absolute;
      inset: 50%;
      inline-size: 1em;
      block-size: 1em;
      margin-block-start: -0.5em;
      margin-inline-start: -0.5em;
      border: 2px solid currentColor;
      border-inline-end-color: transparent;
      border-radius: var(--radius-full);
      animation: btn-spin 600ms linear infinite;
    }
  }

  @keyframes btn-spin {
    to {
      transform: rotate(360deg);
    }
  }

  /* Button-to Form Wrapper
     Rails button_to generates a form with a button inside. This resets the form styles.
  /* ------------------------------------------------------------------------ */

  .btn-to {
    display: inline-flex;

    > button {
      all: inherit;
      cursor: pointer;
    }
  }

  /* Aria-disabled (for links styled as buttons)
  /* ------------------------------------------------------------------------ */

  .btn[aria-disabled="true"] {
    cursor: not-allowed;
    opacity: 0.5;
    pointer-events: none;
  }

}
