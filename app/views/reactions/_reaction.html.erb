<%# locals: (reaction_group:, reactable:) %>

<% emoji = reaction_group[:emoji] %>
<% count = reaction_group[:count] %>
<% user_reacted = reaction_group[:user_reacted] %>
<% user_reaction_id = reaction_group[:user_reaction_id] %>

<% if user_reacted && user_reaction_id %>
  <%# User has reacted - clicking removes their reaction %>
  <%= button_to idea_comment_reaction_path(reactable.idea, reactable, user_reaction_id),
        method: :delete,
        class: "inline-flex items-center gap-1 px-2 py-0.5 text-sm rounded-full border transition-colors #{user_reacted ? 'bg-primary/10 border-primary/30 text-primary hover:bg-primary/20' : 'bg-muted border-transparent text-muted-foreground hover:bg-muted/80'}",
        title: t("reactions.you_reacted", emoji: emoji),
        data: { turbo_frame: dom_id(reactable, :reacting) } do %>
    <span><%= emoji %></span>
    <span class="text-xs font-medium"><%= count %></span>
  <% end %>
<% else %>
  <%# User hasn't reacted - clicking adds their reaction %>
  <%= button_to idea_comment_reactions_path(reactable.idea, reactable),
        params: { reaction: { content: emoji } },
        class: "inline-flex items-center gap-1 px-2 py-0.5 text-sm rounded-full border transition-colors bg-muted border-transparent text-muted-foreground hover:bg-muted/80",
        title: t("reactions.react_with", emoji: emoji),
        data: { turbo_frame: dom_id(reactable, :reacting) } do %>
    <span><%= emoji %></span>
    <span class="text-xs font-medium"><%= count %></span>
  <% end %>
<% end %>
