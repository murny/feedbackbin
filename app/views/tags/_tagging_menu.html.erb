<%# locals: (idea:) %>

<div data-controller="tagging" data-tagging-idea-id-value="<%= idea.id %>">
  <%= render Elements::PopoverComponent.new(side: :bottom, align: :start) do |popover| %>
    <% popover.with_trigger do %>
      <%= render Elements::ButtonComponent.new(
        variant: :outline,
        size: :sm,
        data: { action: "keydown.t@window->tagging#openMenu" }
      ) do %>
        <%= lucide_icon "tag", class: "h-4 w-4" %>
        <%= t(".manage_tags") %>
      <% end %>
    <% end %>

    <% popover.with_popover_content do %>
      <div class="space-y-3">
        <div>
          <label class="text-sm font-medium"><%= t(".add_or_search_tags") %></label>
          <input
            type="text"
            data-tagging-target="input"
            data-action="input->tagging#filterTags keydown.enter->tagging#createTag"
            placeholder="<%= t(".tag_placeholder") %>"
            class="mt-1.5 w-full px-3 py-2 bg-background border border-input rounded-md text-sm focus:outline-hidden focus:ring-2 focus:ring-ring"
          />
        </div>

        <div class="max-h-48 overflow-y-auto space-y-1" data-tagging-target="tagsList">
          <% Current.account.tags.alphabetically.each do |tag| %>
            <div class="flex items-center gap-2 p-2 rounded-md hover:bg-accent cursor-pointer transition-colors"
              data-tagging-target="tagItem"
              data-tag-id="<%= tag.id %>"
              data-tag-title="<%= tag.title %>"
              data-action="click->tagging#toggleTag">
              <% if idea.tags.include?(tag) %>
                <%= lucide_icon "check", class: "h-4 w-4 text-primary" %>
              <% else %>
                <span class="w-4 h-4"></span>
              <% end %>
              <span class="text-sm flex-1"><%= tag.hashtag %></span>
            </div>
          <% end %>
        </div>

        <div class="text-xs text-muted-foreground">
          <%= t(".keyboard_hint") %>
        </div>
      </div>
    <% end %>
  <% end %>
</div>
