<% content_for :title, t(".title") %>

<div class="max-w-screen-2xl mx-auto px-4 sm:px-6 py-8">
  <!-- Page Header -->
  <div class="mb-8">
    <h1 class="text-3xl font-bold tracking-tight"><%= t(".title") %></h1>
    <p class="text-muted-foreground mt-2"><%= t(".description") %></p>
  </div>

  <!-- Filters -->
  <div class="mb-6">
    <div class="flex flex-col sm:flex-row gap-4 sm:items-center sm:justify-between mb-6">
      <!-- Category Filter -->
      <div class="flex items-center gap-2">
        <label class="text-sm font-medium text-muted-foreground"><%= t(".category_label") %></label>
        <%= render_dropdown_menu(
          trigger: (@selected_category&.name || t(".all_categories")),
          width: "w-48",
          trigger_button_variant: :outline,
          content: capture do %>
            <%= link_to t(".all_categories"), roadmap_path(sort: params[:sort], direction: params[:direction], search: @search),
                class: "block px-4 py-2 text-sm hover:bg-muted rounded-sm #{'bg-muted' unless @selected_category}" %>
            <% @categories.each do |category| %>
              <%= link_to roadmap_path(category_id: category.id, sort: params[:sort], direction: params[:direction], search: @search),
                  class: "flex items-center gap-2 px-4 py-2 text-sm hover:bg-muted rounded-sm #{'bg-muted' if @selected_category == category}" do %>
                <span class="w-3 h-3 rounded-full flex-shrink-0" style="background-color: <%= category.color %>;"></span>
                <span><%= category.name %></span>
              <% end %>
            <% end %>
          <% end
        ) %>
      </div>

      <!-- Search -->
      <%= form_with url: roadmap_path, method: :get, class: "w-full sm:w-auto sm:min-w-[320px]" do |f| %>
        <%= f.hidden_field :category_id, value: params[:category_id] %>
        <%= f.hidden_field :sort, value: params[:sort] %>
        <%= f.hidden_field :direction, value: params[:direction] %>
        <div class="relative">
          <%= lucide_icon "search", class: "absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground pointer-events-none" %>
          <%= f.text_field :search, value: @search, placeholder: t(".search_placeholder"),
              class: "w-full h-10 pl-10 pr-10 border border-input rounded-md text-sm bg-background shadow-sm placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-0 transition-shadow" %>
          <% if @search.present? %>
            <%= link_to roadmap_path(category_id: params[:category_id], sort: params[:sort], direction: params[:direction]),
                class: "absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground transition-colors" do %>
              <%= lucide_icon "x", class: "h-4 w-4" %>
            <% end %>
          <% end %>
        </div>
      <% end %>
    </div>

    <!-- Sort Options -->
    <div class="flex items-center gap-2 text-sm">
      <span class="text-muted-foreground font-medium"><%= t(".sort_by_label") %></span>
      <div class="flex items-center gap-1 border border-border rounded-lg p-1 bg-background">
        <%= posts_sort_link text: t(".sort_latest"), sort_field: "created_at", direction: "desc", params: params, path_helper: :roadmap_path %>
        <%= posts_sort_link text: t(".sort_top"), sort_field: "likes_count", direction: "desc", params: params, path_helper: :roadmap_path %>
        <%= posts_sort_link text: t(".sort_most_commented"), sort_field: "comments_count", direction: "desc", params: params, path_helper: :roadmap_path %>
      </div>
    </div>
  </div>

  <!-- Empty State (if filters return no results) -->
  <% if @roadmap_data.values.all?(&:empty?) %>
    <div class="text-center py-12">
      <%= lucide_icon "search-x", class: "h-12 w-12 mx-auto mb-4 text-muted-foreground opacity-50" %>
      <h3 class="text-lg font-semibold mb-2"><%= t(".no_results_title") %></h3>
      <p class="text-muted-foreground mb-4"><%= t(".no_results_description") %></p>
      <%= link_to t(".clear_filters"), roadmap_path, class: "btn btn-primary" %>
    </div>
  <% else %>
    <!-- Kanban Board -->
    <div class="<%= @column_count <= 3 ? "grid grid-cols-#{@column_count} gap-6 pb-4" : "flex gap-6 overflow-x-auto pb-4" %>">
      <% @roadmap_data.each do |status, posts| %>
        <%= render "column", status: status, posts: posts %>
      <% end %>
    </div>
  <% end %>
</div>
