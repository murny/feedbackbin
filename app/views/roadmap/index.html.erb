<% content_for :title, t(".title") %>

<div class="max-w-screen-2xl mx-auto px-4 sm:px-6 py-8">
  <!-- Page Header -->
  <div class="mb-8">
    <h1 class="text-3xl font-bold tracking-tight"><%= t(".title") %></h1>
    <p class="text-muted-foreground mt-2"><%= t(".description") %></p>
  </div>

  <%= turbo_frame_tag "roadmap_content", data: {
    turbo_action: "advance",
    action: "turbo:frame-load->search#searchComplete"
  } do %>
    <!-- Filters -->
    <div class="mb-6">
      <div class="flex flex-col sm:flex-row gap-4 sm:items-center sm:justify-between mb-6">
        <%= render "shared/board_filter",
          path_helper: :roadmap_path,
          boards: @boards,
          selected_board: @selected_board,
          turbo_frame: "roadmap_content",
          preserve_params: {
            sort: params[:sort],
            direction: params[:direction],
            search: @search
          } %>

        <%= render "shared/search_filter",
          path_helper: :roadmap_path,
          search_value: @search,
          turbo_frame: "roadmap_content",
          placeholder: t(".search_placeholder"),
          preserve_params: {
            board_id: params[:board_id],
            sort: params[:sort],
            direction: params[:direction]
          } %>
      </div>
    </div>

    <!-- Sort Options -->
    <div class="flex items-center gap-2 text-sm mb-6">
      <span class="text-muted-foreground font-medium"><%= t(".sort_by_label") %></span>
      <div class="flex items-center gap-1 border border-border rounded-lg p-1 bg-background">
        <%= ideas_sort_link text: t(".sort_latest"), sort_field: "created_at", direction: "desc", params: params, path_helper: :roadmap_path, turbo_frame: "roadmap_content" %>
        <%= ideas_sort_link text: t(".sort_top"), sort_field: "votes_count", direction: "desc", params: params, path_helper: :roadmap_path, turbo_frame: "roadmap_content" %>
        <%= ideas_sort_link text: t(".sort_most_commented"), sort_field: "comments_count", direction: "desc", params: params, path_helper: :roadmap_path, turbo_frame: "roadmap_content" %>
      </div>
    </div>

    <!-- Empty State (if filters return no results) -->
    <% if @roadmap_data.values.all?(&:empty?) %>
      <div class="text-center py-12">
        <%= lucide_icon "search-x", class: "h-12 w-12 mx-auto mb-4 text-muted-foreground opacity-50" %>
        <h3 class="text-lg font-semibold mb-2"><%= t(".no_results_title") %></h3>
        <p class="text-muted-foreground mb-4"><%= t(".no_results_description") %></p>
        <%= link_to t(".clear_filters"), roadmap_path, class: "btn btn--primary", data: { turbo_frame: "roadmap_content" } %>
      </div>
    <% else %>
      <!-- Kanban Board -->
      <div class="<%= roadmap_grid_classes(@column_count) %>">
        <% @roadmap_data.each do |status, ideas| %>
          <%= render "column", status: status, ideas: ideas %>
        <% end %>
      </div>
    <% end %>
  <% end %>
</div>
