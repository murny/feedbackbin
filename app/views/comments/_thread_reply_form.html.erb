<%# locals: (parent:, comment: Comment.new) %>

<div data-controller="reply-form">
  <%# Placeholder button - looks like an input %>
  <button type="button"
          aria-expanded="false"
          aria-controls="<%= dom_id(parent, :reply_form) %>"
          data-reply-form-target="trigger"
          data-action="click->reply-form#expand"
          class="w-full px-3 py-2 text-left text-sm text-muted-foreground bg-card border border-input rounded-md hover:border-ring hover:bg-muted/50 transition-colors">
    <%= t("comments.thread_reply_form.placeholder") %>
  </button>

  <%# Actual form - hidden until triggered %>
  <div id="<%= dom_id(parent, :reply_form) %>" data-reply-form-target="form" class="hidden">
    <%= form_with model: comment, url: idea_comments_path(parent.idea), class: "w-full" do |form| %>
      <%= render "error_messages", resource: form.object %>
      <%= form.hidden_field :parent_id, value: parent.id %>

      <div class="bg-card border border-input rounded-md overflow-hidden focus-within:border-ring focus-within:ring-2 focus-within:ring-ring/50">
        <%= form.rich_text_area :body,
              id: "#{dom_id(parent)}_new_reply_body",
              rows: 1,
              placeholder: t("comments.thread_reply_form.placeholder"),
              data: { reply_form_target: "input" } do %>
          <%= rich_text_prompts %>
        <% end %>
      </div>

      <div class="mt-3 flex items-center gap-3 justify-end">
        <%= button_tag t("cancel"), type: "button", class: "btn btn-secondary btn-sm", data: { action: "click->reply-form#collapse" } %>
        <%= form.submit t("comments.thread_reply_form.submit"), class: "btn btn-primary btn-sm" %>
      </div>
    <% end %>
  </div>
</div>
