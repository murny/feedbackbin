<%# locals: (current_organization:, other_organizations:, classes: "") %>

<div class="relative inline-block <%= classes %>" data-controller="dropdown">
  <button type="button"
          class="inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-10 px-4 py-2 w-[280px]"
          id="organization-switcher-button"
          aria-expanded="false"
          aria-haspopup="true"
          data-action="click->dropdown#toggle click@window->dropdown#hide">
    <div class="flex items-center gap-3 min-w-0 flex-1">
      <%= organization_logo(current_organization) %>
      <span class="text-sm font-medium">
        <%= current_organization.name %>
      </span>
    </div>

    <%= lucide_icon "chevron-down", class: "h-4 w-4 text-muted-foreground opacity-50" %>
  </button>

  <div class="hidden absolute left-0 z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md w-[280px]"
       role="menu"
       aria-orientation="vertical"
       aria-labelledby="organization-switcher-button"
       tabindex="-1"
       data-dropdown-target="menu"
       data-dropdown-toggle-class="hidden"
       data-dropdown-open-value="false"
       data-transition-enter="transition ease-out duration-200"
       data-transition-enter-from="opacity-0 scale-95"
       data-transition-enter-to="opacity-100 scale-100"
       data-transition-leave="transition ease-in duration-75"
       data-transition-leave-from="opacity-100 scale-100"
       data-transition-leave-to="opacity-0 scale-95">

    <div class="px-2 py-1.5">
      <div class="px-2 py-1.5 text-xs font-semibold text-muted-foreground">
        <%= t(".switch_organization") %>
      </div>

      <div class="relative flex w-full cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none bg-accent text-accent-foreground gap-2" role="none">
        <%= organization_logo(current_organization, size: :sm) %>
        <span class="text-sm font-medium">
          <%= current_organization.name %>
        </span>
        <%= lucide_icon "check", class: "ml-auto h-4 w-4 flex-shrink-0" %>
      </div>

      <% other_organizations.each do |organization| %>
        <%= button_to organization_switch_path(organization),
              method: :post,
              params: { return_to: request.fullpath },
              class: "relative flex w-full cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground gap-2",
              role: "menuitem",
              tabindex: "-1" do %>
          <%= organization_logo(organization, size: :sm) %>
          <span class="text-sm font-medium">
            <%= organization.name %>
          </span>
        <% end %>
      <% end %>
    </div>
    <div class="border-t border-border"></div>

    <div class="px-2 py-1.5">
      <% if Current.organization_admin? && current_organization %>
        <%= link_to admin_root_path,
              class: "relative flex w-full cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground",
              role: "menuitem",
              tabindex: "-1" do %>
          <%= lucide_icon "layout-grid", class: "mr-2 h-4 w-4" %>
          <%= t(".manage_organization") %>
        <% end %>
      <% end %>

      <%= link_to new_organization_path,
            class: "relative flex w-full cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground",
            role: "menuitem",
            tabindex: "-1" do %>
        <%= lucide_icon "plus", class: "mr-2 h-4 w-4" %>
        <%= t(".create_organization") %>
      <% end %>

    </div>
  </div>
</div>
