<%# locals: () %>

<nav class="header" data-controller="toggle">
  <div class="header__container">
    <div class="header__content">
      <div class="header__actions header__actions--start">
        <%= link_to branded_logo_url, class: "header__logo" do %>
          <%= branded_logo(class: "header__logo-icon") %>
          <% if show_brand_name? %>
            <span class="header__logo-text"><%= brand_name %></span>
          <% end %>
        <% end %>

        <!-- Desktop Navigation Links -->
        <div class="header__nav">
          <%= active_link_to t(".links.ideas"),
                ideas_path,
                class: "header__link",
                active_class: "header__link--active",
                inactive_class: "" %>
          <%= active_link_to t(".links.roadmap"),
                roadmap_path,
                class: "header__link",
                active_class: "header__link--active",
                inactive_class: "" %>
        </div>
      </div>

      <div class="header__search">
        <div class="header__search-wrapper">
          <label for="search" class="visually-hidden"><%= t(".search") %></label>
          <div class="position-relative">
            <div class="header__search-icon">
              <svg class="size-4 txt-subtle" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                <path fill-rule="evenodd" d="M9 3.5a5.5 5.5 0 100 11 5.5 5.5 0 000-11zM2 9a7 7 0 1112.452 4.391l3.328 3.329a.75.75 0 11-1.06 1.06l-3.329-3.328A7 7 0 012 9z" clip-rule="evenodd" />
              </svg>
            </div>
            <input id="search"
                   name="search"
                   autocomplete="off"
                   class="form__input"
                   style="padding-inline-start: var(--space-10);"
                   placeholder="<%= t(".search_placeholder") %>"
                   type="search">
          </div>
        </div>
      </div>
      <% if Current.user %>
        <div class="flex align-center">
          <div class="flex-item-no-shrink">
            <%= link_to changelogs_path,
                        class: [ "header__changelog-link",
                        unread_changelogs_class(Current.user) ] do %>
            <%= lucide_icon "megaphone", class: "size-6" %>
            <span class="header__changelog-text"><%= t(".links.whats_new") %></span>
            <% end %>
          </div>
        </div>
      <% end %>
      <div class="header__mobile-toggle">
        <!-- Mobile menu button -->
        <button type="button"
                class="header__mobile-toggle-btn"
                aria-controls="mobile-menu"
                data-toggle-target="trigger"
                data-action="click->toggle#toggle touch->toggle#toggle">
          <span class="visually-hidden"><%= t(".open_main_menu") %></span>
          <svg class="size-6" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
          </svg>

          <svg class="display-none size-3" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-toggle-target="toggleable">
            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
          </svg>
        </button>
      </div>
      <div class="header__desktop-actions">
        <% if authenticated? && Current.user %>
          <button type="button" class="header__icon-btn">
            <span class="visually-hidden"><%= t(".view_notifications") %></span>
            <svg class="size-6" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" d="M14.857 17.082a23.848 23.848 0 005.454-1.31A8.967 8.967 0 0118 9.75v-.7V9A6 6 0 006 9v.75a8.967 8.967 0 01-2.312 6.022c1.733.64 3.56 1.085 5.455 1.31m5.714 0a24.255 24.255 0 01-5.714 0m5.714 0a3 3 0 11-5.714 0" />
            </svg>
          </button>

          <!-- Profile dropdown -->
          <div style="margin-inline-start: var(--space-3);">
            <%= render Elements::DropdownMenuComponent.new do |dropdown| %>
              <% dropdown.with_trigger(variant: :ghost, class: "position-relative", style: "border-radius: 9999px; padding: 0;") do %>
                <span class="visually-hidden"><%= t(".open_user_menu") %></span>
                <%= image_tag fresh_user_avatar_path(Current.user), role: "presentation", class: "avatar", alt: "" %>
              <% end %>

              <% dropdown.with_item_label do %>
                <p class="txt-small txt-subtle"><%= t(".signed_in_as") %></p>
                <p class="overflow-ellipsis txt-small font-weight-medium"><%= Current.user.name %></p>
              <% end %>

              <% dropdown.with_item_separator %>

              <% dropdown.with_item_content(href: user_path(Current.user)) do %>
                <%= t(".links.your_profile") %>
              <% end %>

              <% dropdown.with_item_content(href: user_settings_profile_path) do %>
                <%= t(".links.settings") %>
              <% end %>

              <% if Current.admin? && Current.account %>
                <% dropdown.with_item_separator %>

                <% dropdown.with_item_content(href: admin_root_path) do %>
                  <%= t(".links.admin_dashboard") %>
                <% end %>
              <% end %>

              <% if Rails.env.development? %>
                <% dropdown.with_item_separator %>

                <% dropdown.with_item_content(href: letter_opener_web_path) do %>
                  <%= t(".links.letter_opener") %>
                <% end %>

                <% dropdown.with_item_content(href: staff_mission_control_jobs_path) do %>
                  <%= t(".links.mission_control_jobs") %>
                <% end %>
              <% end %>

              <% dropdown.with_item_separator %>

              <% dropdown.with_item_content(
                href: session_path,
                method: :delete
              ) do %>
                <%= t(".sign_out") %>
              <% end %>

              <% if Current.identity.staff? %>
                <% dropdown.with_item_separator %>

                <% dropdown.with_item_content(href: staff_root_path) do %>
                  <%= t(".links.staff") %>
                <% end %>
              <% end %>
            <% end %>
          </div>
        <% else %>
          <%= link_to t(".sign_up"), users_sign_up_path, class: "btn btn--secondary" %>
          <%= link_to t(".sign_in"), sign_in_path, class: "btn btn--primary", style: "margin-inline-start: var(--space-2);" %>
        <% end %>
      </div>
    </div>
  </div>

  <!-- Mobile menu, show/hide based on menu state. -->
  <div class="display-none" id="mobile-menu"
        data-toggle-target="toggleable"
        data-transition-enter="transition-all ease-linear duration-300"
        data-transition-enter-from="opacity-0 h-0"
        data-transition-enter-to="opacity-100"
        data-transition-leave="transition-all ease-linear duration-300"
        data-transition-leave-from="opacity-100"
        data-transition-leave-to="opacity-0">
    <div class="header__mobile-menu">
          <%= active_link_to t(".links.ideas"),
            ideas_path,
            class: "header__mobile-link",
            active_class: "header__mobile-link--active",
            inactive_class: "" %>
      <%= active_link_to t(".links.roadmap"),
            roadmap_path,
            class: "header__mobile-link",
            active_class: "header__mobile-link--active",
            inactive_class: "" %>
    </div>
    <div class="border-top pad-block-start pad-block-end-half">
      <% if authenticated? && Current.user %>
        <div class="header__mobile-user">
          <div class="header__mobile-user-avatar">
            <%= image_tag fresh_user_avatar_path(Current.user), role: "presentation", class: "avatar avatar--lg", alt: "" %>
          </div>
          <div class="header__mobile-user-info">
            <div class="txt-small txt-subtle"><%= t(".signed_in_as") %></div>
            <div class="font-weight-medium"><%= Current.user.name %></div>
          </div>
          <button type="button" class="header__icon-btn margin-inline-start-auto">
            <span class="visually-hidden"><%= t(".view_notifications") %></span>
            <svg class="size-6" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" d="M14.857 17.082a23.848 23.848 0 005.454-1.31A8.967 8.967 0 0118 9.75v-.7V9A6 6 0 006 9v.75a8.967 8.967 0 01-2.312 6.022c1.733.64 3.56 1.085 5.455 1.31m5.714 0a24.255 24.255 0 01-5.714 0m5.714 0a3 3 0 11-5.714 0" />
            </svg>
          </button>
        </div>
        <div class="header__mobile-menu margin-block-start-half">
          <%= link_to t(".links.your_profile"),
                user_path(Current.user),
                class: "header__mobile-link" %>
          <%= link_to t(".links.settings"),
                user_settings_profile_path,
                class: "header__mobile-link" %>
        </div>
        <div class="header__mobile-menu margin-block-start-half border-top pad-block-start-half">
          <% if Current.admin? && Current.account %>
            <%= link_to t(".links.admin_dashboard"),
                  admin_root_path,
                  class: "header__mobile-link" %>
          <% end %>
        </div>
        <div class="header__mobile-menu margin-block-start-half border-top pad-block-start-half">
          <%= button_to t(".sign_out"), session_path, method: :delete, class: "header__mobile-link" %>
        </div>
      <% else %>
        <div class="header__mobile-menu">
          <%= link_to t(".sign_in"), sign_in_path, class: "header__mobile-link" %>
          <%= link_to t(".sign_up"), users_sign_up_path, class: "header__mobile-link" %>
        </div>
      <% end %>
    </div>
  </div>
</nav>
