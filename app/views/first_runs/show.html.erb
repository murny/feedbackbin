<% content_for :title, t(".title") %>

<div class="container mx-auto max-w-2xl py-8">
  <div class="space-y-6">
    <div class="text-center space-y-2">
      <h1 class="text-3xl font-bold tracking-tight">
        <%= t(".title") %>
      </h1>
      <p class="text-muted-foreground">
        <%= t(".description") %>
      </p>
    </div>

    <%= render_card do %>
      <div class="px-6">
        <%= render_form_with(model: @first_run,
                             url: first_run_path,
                             data: {
                              controller: "form badge-preview",
                              action: "keydown.enter->form#submit:prevent"
                             }
                            ) do |form| %>
          <%= render "error_messages", resource: @first_run %>

          <div class="space-y-8">
            <!-- User Account Section -->
            <div class="space-y-4">
              <div>
                <h3 class="text-base font-medium"><%= t(".account_setup") %></h3>
                <p class="text-sm text-muted-foreground"><%= t(".account_setup_description") %></p>
              </div>

              <div class="grid gap-4">
                <!-- Avatar Upload -->
                <%= tag.div class: "flex items-start gap-x-4", data: { controller: "upload-preview", upload_preview_default_image_value: asset_path("default-avatar.svg") } do %>
                  <%= image_tag "default-avatar.svg",
                        role: "presentation",
                        alt: "",
                        class: "h-20 w-20 flex-none rounded-lg bg-muted object-cover border",
                        data: { "upload-preview-target": "image" } %>

                  <div class="space-y-3 flex-1">
                    <%= form.file_field :avatar,
                          accept: "image/*",
                          data: { upload_preview_target: "input", action: "upload-preview#previewImage" },
                          class: "hidden" %>

                    <div class="flex flex-wrap items-center gap-2">
                      <%= form.label :avatar, class: "inline-flex items-center btn btn-secondary" do %>
                        <%= lucide_icon "camera", class: "h-4 w-4 mr-2" %>
                        <%= t(".upload_avatar") %>
                      <% end %>
                    </div>

                    <p class="text-xs text-muted-foreground">
                      <%= t(".avatar_size_hint") %>
                    </p>
                  </div>
                <% end %>

                <!-- User Details -->
                <div class="grid gap-4">
                  <div class="grid gap-2">
                    <%= form.label :email_address, class: "text-sm font-medium" %>
                    <%= form.email_field :email_address,
                          required: true,
                          autofocus: true,
                          autocomplete: "email",
                          placeholder: t(".email_address_placeholder") %>
                    <p class="text-xs text-muted-foreground"><%= t(".email_address_hint") %></p>
                  </div>

                  <div class="grid gap-2">
                    <%= form.label :username, class: "text-sm font-medium" %>
                    <%= form.text_field :username,
                          required: true,
                          autocomplete: "username",
                          placeholder: t(".username_placeholder") %>
                    <p class="text-xs text-muted-foreground"><%= t(".username_hint") %></p>
                  </div>

                  <div class="grid gap-2">
                    <%= form.label :password, class: "text-sm font-medium" %>
                    <%= form.password_field :password,
                          required: true,
                          autocomplete: "new-password",
                          placeholder: t(".password_placeholder") %>
                    <p class="text-xs text-muted-foreground"><%= t(".password_hint") %></p>
                  </div>

                  <div class="grid gap-2">
                    <%= form.label :name, class: "text-sm font-medium" %>
                    <%= form.text_field :name,
                          required: false,
                          autocomplete: "name",
                          placeholder: t(".name_placeholder") %>
                    <p class="text-xs text-muted-foreground"><%= t(".name_hint") %></p>
                  </div>
                </div>
              </div>
            </div>

            <!-- Organization Setup Section -->
            <div class="space-y-4">
              <div>
                <h3 class="text-base font-medium"><%= t(".organization_setup") %></h3>
                <p class="text-sm text-muted-foreground"><%= t(".organization_setup_description") %></p>
              </div>

              <div class="grid gap-4">
                <div class="grid gap-2">
                  <%= form.label :organization_name, t(".organization_name"), class: "text-sm font-medium" %>
                  <%= form.text_field :organization_name,
                        required: true,
                        placeholder: t(".organization_name_placeholder") %>
                </div>

                <% if Rails.application.config.multi_tenant %>
                  <div class="grid gap-2">
                    <%= form.label :organization_subdomain, t(".organization_subdomain"), class: "text-sm font-medium" %>
                    <%= form.text_field :organization_subdomain,
                          required: true,
                          autocapitalize: "off",
                          spellcheck: false,
                          placeholder: t(".subdomain_placeholder") %>
                    <p class="text-xs text-muted-foreground"><%= t(".subdomain_hint") %></p>
                  </div>
                <% end %>

                <!-- Organization Logo -->
                <%= tag.div class: "flex items-start gap-x-4", data: { controller: "upload-preview", upload_preview_default_image_value: asset_path("default-logo.svg") } do %>
                  <%= image_tag "default-logo.svg",
                        role: "presentation",
                        alt: "",
                        class: "h-20 w-20 flex-none rounded-lg bg-muted object-cover border",
                        data: { "upload-preview-target": "image" } %>

                  <div class="space-y-3 flex-1">
                    <%= form.file_field :organization_logo,
                          accept: "image/*",
                          data: { upload_preview_target: "input", action: "upload-preview#previewImage" },
                          class: "hidden" %>

                    <div class="flex flex-wrap items-center gap-2">
                      <%= form.label :organization_logo, class: "inline-flex items-center btn btn-secondary" do %>
                        <%= lucide_icon "camera", class: "h-4 w-4 mr-2" %>
                        <%= t(".upload_organization_logo") %>
                      <% end %>
                    </div>

                    <p class="text-xs text-muted-foreground">
                      <%= t(".logo_size_hint") %>
                    </p>
                  </div>
                <% end %>

                <!-- Category -->
                <div class="grid gap-2">
                  <%= form.label :category_name, t(".initial_category"), class: "text-sm font-medium" %>
                  <%= form.text_field :category_name,
                        placeholder: t(".category_placeholder"),
                        data: { badge_preview_target: "nameInput", action: "input->badge-preview#updatePreview" } %>
                  <p class="text-xs text-muted-foreground"><%= t(".category_hint") %></p>
                </div>

                <div class="grid gap-2">
                  <%= form.label :category_color, t(".category_color"), class: "text-sm font-medium" %>
                  <div class="flex items-center gap-3">
                    <%= form.color_field :category_color,
                          value: @first_run.category_color,
                          class: "h-10 w-20 rounded-md border border-input cursor-pointer",
                          data: { badge_preview_target: "colorInput", action: "input->badge-preview#updatePreview" } %>
                    <span class="text-sm text-muted-foreground"><%= t(".category_color_hint") %></span>
                  </div>
                </div>

                <div class="rounded-lg border border-border bg-muted/50 p-4">
                  <h4 class="text-sm font-medium mb-2"><%= t(".category_preview") %></h4>
                  <%= render_badge(
                    variant: :outline,
                    class: "gap-1.5 text-muted-foreground bg-muted/30 border-border"
                  ) do %>
                    <span class="w-2 h-2 rounded-full flex-shrink-0" style="background-color: <%= @first_run.category_color %>;" data-badge-preview-target="previewColor"></span>
                    <span data-badge-preview-target="previewName"><%= @first_run.category_name %></span>
                  <% end %>
                </div>
              </div>
            </div>
          </div>

          <!-- Form Actions -->
          <div class="flex justify-end pt-6 border-t">
            <%= form.submit t(".create_account_and_organization"), class: "btn btn-primary" %>
          </div>
        <% end %>
      </div>
    <% end %>
  </div>
</div>
