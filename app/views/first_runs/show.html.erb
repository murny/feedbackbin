<% content_for :title, t(".title") %>

<div class="container mx-auto max-w-2xl py-8">
  <div class="space-y-6">
    <div class="text-center space-y-2">
      <h1 class="text-3xl font-bold tracking-tight">
        <%= t(".title") %>
      </h1>
      <p class="text-muted-foreground">
        <%= t(".description") %>
      </p>
    </div>

    <%= render Elements::CardComponent.new do |c| %>
      <% c.with_body do %>
        <%= form_with(model: @first_run,
                      url: first_run_path,
                      class: "space-y-6",
                      data: {
                        controller: "form badge-preview",
                        action: "keydown.enter->form#submit:prevent"
                      }
                     ) do |form| %>
          <%= render "error_messages", resource: @first_run %>

          <div class="space-y-8">
            <!-- User Account Section -->
            <div class="space-y-4">
              <div>
                <h3 class="text-base font-medium"><%= t(".account_setup") %></h3>
                <p class="text-sm text-muted-foreground"><%= t(".account_setup_description") %></p>
              </div>

              <div class="grid gap-4">
                <!-- Avatar Upload -->
                <%= render ImageUploadPreviewComponent.new(
                      form: form,
                      field_name: :avatar,
                      preview_url: asset_path("default-avatar.svg"),
                      upload_button_text: t(".upload_avatar"),
                      size_hint: t(".avatar_size_hint")) %>

                <!-- User Details -->
                <div class="grid gap-4">
                  <div class="grid gap-2">
                    <%= form.label :name, class: "text-sm font-medium" %>
                    <%= form.text_field :name,
                          required: true,
                          autofocus: true,
                          autocomplete: "name",
                          placeholder: t(".name_placeholder") %>
                    <p class="text-xs text-muted-foreground"><%= t(".name_hint") %></p>
                  </div>

                  <div class="grid gap-2">
                    <%= form.label :email_address, class: "text-sm font-medium" %>
                    <%= form.email_field :email_address,
                          required: true,
                          autocomplete: "email",
                          placeholder: t(".email_address_placeholder") %>
                    <p class="text-xs text-muted-foreground"><%= t(".email_address_hint") %></p>
                  </div>

                  <div class="grid gap-2">
                    <%= form.label :password, class: "text-sm font-medium" %>
                    <%= form.password_field :password,
                          required: true,
                          autocomplete: "new-password",
                          placeholder: t(".password_placeholder") %>
                    <p class="text-xs text-muted-foreground"><%= t(".password_hint") %></p>
                  </div>
                </div>
              </div>
            </div>

            <!-- Account Setup Section -->
            <div class="space-y-4">
              <div>
                <h3 class="text-base font-medium"><%= t(".account_setup_section") %></h3>
                <p class="text-sm text-muted-foreground"><%= t(".account_setup_description") %></p>
              </div>

              <div class="grid gap-4">
                <div class="grid gap-2">
                  <%= form.label :account_name, t(".account_name"), class: "text-sm font-medium" %>
                  <%= form.text_field :account_name,
                        required: true,
                        placeholder: t(".account_name_placeholder") %>
                </div>

                <% if Rails.application.config.multi_tenant %>
                  <div class="grid gap-2">
                    <%= form.label :account_subdomain, t(".account_subdomain"), class: "text-sm font-medium" %>
                    <%= form.text_field :account_subdomain,
                          required: true,
                          autocapitalize: "off",
                          spellcheck: false,
                          placeholder: t(".subdomain_placeholder") %>
                    <p class="text-xs text-muted-foreground"><%= t(".subdomain_hint") %></p>
                  </div>
                <% end %>

                <!-- Account Logo -->
                <%= render ImageUploadPreviewComponent.new(
                      form: form,
                      field_name: :account_logo,
                      preview_url: asset_path("default-logo.svg"),
                      upload_button_text: t(".upload_account_logo"),
                      size_hint: t(".logo_size_hint")) %>

                <!-- Board -->
                <div class="grid gap-2">
                  <%= form.label :board_name, t(".initial_board"), class: "text-sm font-medium" %>
                  <%= form.text_field :board_name,
                        placeholder: t(".board_placeholder"),
                        data: { badge_preview_target: "nameInput", action: "input->badge-preview#updatePreview" } %>
                  <p class="text-xs text-muted-foreground"><%= t(".board_hint") %></p>
                </div>

                <div class="grid gap-2">
                  <%= form.label :board_color, t(".board_color"), class: "text-sm font-medium" %>
                  <div class="flex items-center gap-3">
                    <%= form.color_field :board_color,
                          value: @first_run.board_color,
                          class: "h-10 w-20 rounded-md border border-input cursor-pointer",
                          data: { badge_preview_target: "colorInput", action: "input->badge-preview#updatePreview" } %>
                    <span class="text-sm text-muted-foreground"><%= t(".board_color_hint") %></span>
                  </div>
                </div>

                <div class="rounded-lg border border-border bg-muted/50 p-4">
                  <h4 class="text-sm font-medium mb-2"><%= t(".board_preview") %></h4>
                  <%= render Elements::BadgeComponent.new(
                    variant: :outline,
                    class: "gap-1.5 text-muted-foreground bg-muted/30 border-border"
                  ) do %>
                    <span class="w-2 h-2 rounded-full shrink-0" style="background-color: <%= @first_run.board_color %>;" data-badge-preview-target="previewColor"></span>
                    <span data-badge-preview-target="previewName"><%= @first_run.board_name %></span>
                  <% end %>
                </div>
              </div>
            </div>
          </div>

          <!-- Form Actions -->
          <div class="flex justify-end pt-6 border-t">
            <%= form.submit t(".create_account"), class: "btn btn-primary" %>
          </div>
        <% end %>
      <% end %>
    <% end %>
  </div>
</div>
