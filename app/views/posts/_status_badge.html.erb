<%# locals: (post:) %>

<span id="post-status-badge">
  <% if policy(post).update_status? %>
    <%= render Ui::DropdownMenuComponent.new do |dropdown| %>
      <% dropdown.with_trigger do %>
        <button type="button"
               class="inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-semibold text-white transition-opacity hover:opacity-80 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2"
               style="background-color: <%= post.post_status.color %>;">
          <%= post.post_status.name %>
        </button>
      <% end %>

      <% PostStatus.ordered.each do |status| %>
        <%= turbo_frame_tag("post-status-#{status.id}") do %>
          <% dropdown.with_item_content(
            href: post_status_path(post),
            method: :patch,
            params: { post_status_id: status.id },
            class: status.id == post.post_status_id ? "bg-accent" : nil
          ) do %>
            <span class="w-3 h-3 rounded-full flex-shrink-0" style="background-color: <%= status.color %>;"></span>
            <span><%= status.name %></span>
            <% if status.id == post.post_status_id %>
              <span class="ml-auto">
                <%= lucide_icon("check", class: "w-4 h-4") %>
              </span>
            <% end %>
          <% end %>
        <% end %>
      <% end %>
    <% end %>
  <% else %>
    <%= render Ui::BadgeComponent.new(class: "text-white font-medium", style: "background-color: #{post.post_status.color};") do %>
      <%= post.post_status.name %>
    <% end %>
  <% end %>
</span>
