<%# locals: (idea:) %>

<span id="idea-status-badge">
  <% if policy(idea).update_status? %>
    <%= render Elements::DropdownMenuComponent.new do |dropdown| %>
      <% dropdown.with_trigger(
        type: "button",
        class: "inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-semibold text-white transition-opacity hover:opacity-80 focus:outline-hidden focus:ring-2 focus:ring-ring focus:ring-offset-2",
        style: "background-color: #{idea.status_color};"
      ) do %>
        <%= idea.status_name %>
      <% end %>

      <%# Open (nil status) option %>
      <% dropdown.with_item_content(
        id: "idea-status-open",
        href: idea_status_path(idea),
        method: :patch,
        params: { status_id: nil },
        class: idea.open? ? "bg-accent" : nil
      ) do %>
        <span class="w-3 h-3 rounded-full shrink-0" style="background-color: <%= Idea::DEFAULT_STATUS_COLOR %>;"></span>
        <span><%= t("ideas.default_status") %></span>
        <% if idea.open? %>
          <span class="ml-auto">
            <%= lucide_icon("check", class: "w-4 h-4") %>
          </span>
        <% end %>
      <% end %>

      <% Status.ordered.each do |status| %>
        <% dropdown.with_item_content(
          id: "idea-status-#{status.id}",
          href: idea_status_path(idea),
          method: :patch,
          params: { status_id: status.id },
          class: status.id == idea.status_id ? "bg-accent" : nil
        ) do %>
          <span class="w-3 h-3 rounded-full shrink-0" style="background-color: <%= status.color %>;"></span>
          <span><%= status.name %></span>
          <% if status.id == idea.status_id %>
            <span class="ml-auto">
              <%= lucide_icon("check", class: "w-4 h-4") %>
            </span>
          <% end %>
        <% end %>
      <% end %>
    <% end %>
  <% else %>
    <%= render Elements::BadgeComponent.new(class: "text-white font-medium", style: "background-color: #{idea.status_color};") do %>
      <%= idea.status_name %>
    <% end %>
  <% end %>
</span>
