<%# locals: (path_helper:, search_value:, turbo_frame:, preserve_params: {}, placeholder:) %>

<div class="w-full sm:w-auto sm:min-w-[320px]"
     data-controller="search"
     data-search-delay-value="300"
     data-search-autofocus-value="false"
     data-search-loading-class="opacity-75"
     data-search-filtering-class="ring-2 ring-primary">
  <%= form_with url: send(path_helper), method: :get,
      data: {
        turbo_frame: turbo_frame,
        search_target: "form"
      } do |f| %>
    <% preserve_params.each do |key, value| %>
      <%= f.hidden_field key, value: value %>
    <% end %>
    <div class="relative">
      <%= lucide_icon "search", class: "absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground pointer-events-none" %>
      <%= f.search_field :search, value: search_value, placeholder: placeholder,
          autocomplete: "off",
          class: "w-full h-10 pl-10 pr-10 border border-input rounded-md text-sm bg-background shadow-sm placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-0 transition-shadow",
          data: {
            search_target: "input",
            action: "input->search#search"
          } %>
      <% if search_value.present? %>
        <%= link_to send(path_helper, **clean_params(**preserve_params)),
            class: "absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground transition-colors",
            data: { turbo_frame: turbo_frame } do %>
          <%= lucide_icon "x", class: "h-4 w-4" %>
        <% end %>
      <% end %>
    </div>
  <% end %>
</div>
