<% content_for :title, @user.name %>

<div class="space-y-8">
  <!-- Header Section -->
  <div class="flex flex-col space-y-4 sm:flex-row sm:items-center sm:justify-between sm:space-y-0">
    <div class="space-y-1">
      <h1 class="text-3xl font-bold tracking-tight text-foreground">
        <%= @user.name %>
      </h1>
      <p class="text-muted-foreground">
        <%= t(".description") %>
      </p>
    </div>
    <%= render_button(
      text: t(".back_button"),
      href: admin_users_path,
      variant: :outline
    ) %>
  </div>

  <!-- User Info -->
  <%= render_card(title: t(".user_info_title"), class: "px-6") do %>
    <div class="flex items-start space-x-6">
      <%= render_avatar(
        src: @user.avatar.attached? ? url_for(@user.avatar) : nil,
        alt: @user.name,
        size: :xl,
        fallback: @user.name[0, 2].upcase
      ) %>

      <div class="flex-1 space-y-4">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <h4 class="text-sm font-medium text-foreground mb-2"><%= t(".basic_info_title") %></h4>
            <div class="space-y-2 text-sm">
              <div><strong><%= t(".name_label") %>:</strong> <%= @user.name %></div>
              <div><strong><%= t(".email_label") %>:</strong> <%= @user.email_address %></div>
              <% if @user.username.present? %>
                <div><strong><%= t(".username_label") %>:</strong> @<%= @user.username %></div>
              <% end %>
              <div><strong><%= t(".joined_label") %>:</strong> <%= @user.created_at.strftime("%B %d, %Y") %></div>
            </div>
          </div>

          <div class="space-y-4">
            <!-- Role -->
            <div>
              <h4 class="text-sm font-medium text-foreground mb-3"><%= t(".role_label") %></h4>
              <div class="flex items-center justify-between gap-4">
                <div class="flex flex-wrap gap-1">
                  <%= render_badge(
                    text: @user.role.humanize,
                    variant: @user.administrator? ? :default : :secondary
                  ) %>
                  <% if @user.organization_owner? %>
                    <%= render_badge(
                      text: t(".owner_badge"),
                      variant: :default
                    ) %>
                  <% end %>
                </div>
                <!-- Role Management -->
                <%= form_with url: update_role_admin_user_path(@user), method: :patch, class: "flex gap-2 items-center" do |form| %>
                  <%= form.select :role,
                      options_for_select(
                        User.roles.keys.map { |role| [ role.humanize, role ] },
                        @user.role
                      ),
                      {},
                      class: "select" %>
                  <%= render_button(
                    text: t(".update_button"),
                    variant: :secondary,
                    size: :sm,
                    type: :submit
                  ) %>
                <% end %>
              </div>
            </div>

            <!-- Account Status -->
            <div>
              <h4 class="text-sm font-medium text-foreground mb-3"><%= t(".account_status_label") %></h4>
              <div class="flex items-center justify-between gap-4">
                <%= render_badge(
                  text: @user.active? ? t(".active_badge") : t(".deactivated_badge"),
                  variant: @user.active? ? :default : :destructive
                ) %>
                <!-- Status Management -->
                <% if @user.active? %>
                  <%= render_button(
                    href: deactivate_admin_user_path(@user),
                    variant: :destructive,
                    size: :sm,
                    data: { turbo_method: :patch, turbo_confirm: t(".deactivate_confirm") }
                  ) do %>
                    <%= lucide_icon "user-x", class: "size-4" %>
                    <span><%= t(".deactivate_user") %></span>
                  <% end %>
                <% else %>
                  <%= render_button(
                    href: activate_admin_user_path(@user),
                    variant: :default,
                    size: :sm,
                    data: { turbo_method: :patch }
                  ) do %>
                    <%= lucide_icon "user-check", class: "size-4" %>
                    <span><%= t(".activate_user") %></span>
                  <% end %>
                <% end %>
              </div>
            </div>

            <!-- Email Verification -->
            <div>
              <h4 class="text-sm font-medium text-foreground mb-3"><%= t(".email_verification_label") %></h4>
              <%= render_badge(
                text: @user.email_verified? ? t(".verified_badge") : t(".unverified_badge"),
                variant: @user.email_verified? ? :default : :outline
              ) %>
            </div>
          </div>
        </div>
      </div>
    </div>
  <% end %>

  <!-- Activity Statistics -->
  <%= render_card(title: t(".activity_stats_title"), class: "px-6") do %>
    <div class="grid grid-cols-1 sm:grid-cols-3 gap-6">
      <div class="p-4 border border-border rounded-lg">
        <div class="text-2xl font-bold text-foreground"><%= @total_posts %></div>
        <div class="text-sm text-muted-foreground"><%= t(".total_posts") %></div>
      </div>
      <div class="p-4 border border-border rounded-lg">
        <div class="text-2xl font-bold text-foreground"><%= @total_comments %></div>
        <div class="text-sm text-muted-foreground"><%= t(".total_comments") %></div>
      </div>
      <div class="p-4 border border-border rounded-lg">
        <div class="text-2xl font-bold text-foreground"><%= @total_likes %></div>
        <div class="text-sm text-muted-foreground"><%= t(".total_likes") %></div>
      </div>
    </div>
  <% end %>

  <!-- Account Information -->
  <%= render_card(title: t(".account_info_title"), class: "px-6") do %>
    <div class="space-y-3 text-sm">
      <div class="flex justify-between py-2 border-b border-border">
        <span class="text-muted-foreground"><%= t(".member_since") %></span>
        <span class="font-medium text-foreground"><%= @user.created_at.strftime("%B %d, %Y") %> (<%= time_ago_in_words(@user.created_at) %> <%= t(".ago") %>)</span>
      </div>
      <div class="flex justify-between py-2 border-b border-border">
        <span class="text-muted-foreground"><%= t(".account_status") %></span>
        <span class="font-medium"><%= @user.active? ? t(".active_status") : t(".deactivated_status") %></span>
      </div>
      <div class="flex justify-between py-2 border-b border-border">
        <span class="text-muted-foreground"><%= t(".email_status") %></span>
        <span class="font-medium"><%= @user.email_verified? ? t(".email_verified") : t(".email_unverified") %></span>
      </div>
      <% if @last_session %>
        <div class="flex justify-between py-2">
          <span class="text-muted-foreground"><%= t(".last_sign_in") %></span>
          <span class="font-medium text-foreground"><%= time_ago_in_words(@last_session.last_active_at) %> <%= t(".ago") %></span>
        </div>
      <% else %>
        <div class="flex justify-between py-2">
          <span class="text-muted-foreground"><%= t(".last_sign_in") %></span>
          <span class="font-medium text-muted-foreground"><%= t(".never_signed_in") %></span>
        </div>
      <% end %>
    </div>
  <% end %>

  <!-- Recent Posts -->
  <%= render_card(title: t(".recent_posts_title"), class: "px-6") do %>
    <% if @recent_posts.any? %>
      <div class="space-y-4">
        <% @recent_posts.each do |post| %>
          <div class="flex items-start space-x-3 p-3 rounded-lg hover:bg-muted/50 transition-colors">
            <div class="min-w-0 flex-1">
              <div class="font-medium text-foreground truncate"><%= post.title %></div>
              <div class="text-sm text-muted-foreground">
                <%= time_ago_in_words(post.created_at) %> <%= t(".ago") %>
              </div>
              <% if post.category %>
                <%= render_badge(
                  text: post.category.name,
                  variant: :outline
                ) %>
              <% end %>
            </div>
            <div class="text-xs text-muted-foreground">
              <%= pluralize(post.likes_count, t(".like_singular"), t(".like_plural")) %> â€¢ <%= pluralize(post.comments_count, t(".comment_singular"), t(".comment_plural")) %>
            </div>
          </div>
        <% end %>
      </div>
    <% else %>
      <div class="text-center py-8 text-muted-foreground">
        <%= t(".no_posts") %>
      </div>
    <% end %>
  <% end %>
</div>
