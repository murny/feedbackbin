<% content_for :title, t(".title") %>

<div class="flex flex-column" style="gap: var(--space-8);">
  <div class="flex flex-column" style="gap: var(--space-1);">
    <h1 class="txt-xx-large font-weight-bold">
      <%= t(".heading") %>
    </h1>
    <p class="txt-subtle">
      <%= t(".description") %>
    </p>
  </div>

  <div class="flex flex-column" style="gap: var(--space-4);">
    <div class="flex flex-column sm:flex-row" style="gap: var(--space-4);">
      <div class="flex-1" style="max-inline-size: 28rem;"
           data-controller="search"
           data-search-delay-value="300"
           data-search-loading-class="opacity-75"
           data-search-filtering-class="ring-2 ring-primary">
        <%= form_with url: admin_users_path, method: :get,
            data: {
              turbo_frame: "users_content",
              search_target: "form"
            } do |form| %>
          <%= form.label :search, t(".search_label"), class: "visually-hidden" %>
          <%= form.search_field :search,
              placeholder: t(".search_placeholder"),
              value: params[:search],
              autocomplete: "off",
              class: "input full-width",
              data: {
                search_target: "input",
                action: "input->search#search"
              } %>
          <%= form.hidden_field :role, value: params[:role] %>
          <%= form.hidden_field :status, value: params[:status] %>
        <% end %>
      </div>

      <div class="full-width sm:w-auto">
        <%= form_with url: admin_users_path, method: :get,
            data: { turbo_frame: "users_content" } do |form| %>
          <%= form.select :role,
              options_for_select(
                [
                  [ t(".filter_all_roles"), "" ],
                  [ t(".filter_admins"), "admin" ],
                  [ t(".filter_members"), "member" ],
                  [ t(".filter_bots"), "bot" ]
                ],
                params[:role]
              ),
              {},
              class: "select",
              onchange: "this.form.requestSubmit()" %>
          <%= form.hidden_field :search, value: params[:search] %>
          <%= form.hidden_field :status, value: params[:status] %>
        <% end %>
      </div>

      <div class="full-width sm:w-auto">
        <%= form_with url: admin_users_path, method: :get,
            data: { turbo_frame: "users_content" } do |form| %>
          <%= form.select :status,
              options_for_select(
                [
                  [ t(".filter_all_status"), "" ],
                  [ t(".filter_active"), "active" ],
                  [ t(".filter_deactivated"), "deactivated" ]
                ],
                params[:status]
              ),
              {},
              class: "select",
              onchange: "this.form.requestSubmit()" %>
          <%= form.hidden_field :search, value: params[:search] %>
          <%= form.hidden_field :role, value: params[:role] %>
        <% end %>
      </div>
    </div>
  </div>

  <%= turbo_frame_tag "users_content",
      data: { action: "turbo:frame-load->search#searchComplete" } do %>
    <%= render "users_list", users: @users, pagy: @pagy %>
  <% end %>
</div>
