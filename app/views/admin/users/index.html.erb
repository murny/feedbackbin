<% content_for :title, t(".title") %>

<div class="space-y-8">
  <!-- Header Section -->
  <div class="space-y-1">
    <h1 class="text-3xl font-bold tracking-tight text-foreground">
      <%= t(".heading") %>
    </h1>
    <p class="text-muted-foreground">
      <%= t(".description") %>
    </p>
  </div>

  <!-- Search and Filters Section -->
  <div class="space-y-4">
    <div class="flex flex-col sm:flex-row gap-4">
      <!-- Search -->
      <div class="flex-1 max-w-md"
           data-controller="search"
           data-search-delay-value="300"
           data-search-loading-class="opacity-75"
           data-search-filtering-class="ring-2 ring-primary">
        <%= form_with url: admin_users_path, method: :get,
            data: {
              turbo_frame: "users_content",
              search_target: "form"
            } do |form| %>
          <%= form.label :search, t(".search_label"), class: "sr-only" %>
          <%= form.search_field :search,
              placeholder: t(".search_placeholder"),
              value: params[:search],
              autocomplete: "off",
              class: "w-full px-4 py-2 border border-input bg-background rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-ring focus:border-ring transition-colors",
              data: {
                search_target: "input",
                action: "input->search#search"
              } %>
          <%= form.hidden_field :role, value: params[:role] %>
          <%= form.hidden_field :status, value: params[:status] %>
        <% end %>
      </div>

      <!-- Role Filter -->
      <div class="w-full sm:w-auto">
        <%= form_with url: admin_users_path, method: :get,
            data: { turbo_frame: "users_content" } do |form| %>
          <%= form.select :role,
              options_for_select(
                [
                  [ t(".filter_all_roles"), "" ],
                  [ t(".filter_administrators"), "administrator" ],
                  [ t(".filter_members"), "member" ],
                  [ t(".filter_bots"), "bot" ]
                ],
                params[:role]
              ),
              {},
              class: "select",
              onchange: "this.form.requestSubmit()" %>
          <%= form.hidden_field :search, value: params[:search] %>
          <%= form.hidden_field :status, value: params[:status] %>
        <% end %>
      </div>

      <!-- Status Filter -->
      <div class="w-full sm:w-auto">
        <%= form_with url: admin_users_path, method: :get,
            data: { turbo_frame: "users_content" } do |form| %>
          <%= form.select :status,
              options_for_select(
                [
                  [ t(".filter_all_status"), "" ],
                  [ t(".filter_active"), "active" ],
                  [ t(".filter_deactivated"), "deactivated" ]
                ],
                params[:status]
              ),
              {},
              class: "select",
              onchange: "this.form.requestSubmit()" %>
          <%= form.hidden_field :search, value: params[:search] %>
          <%= form.hidden_field :role, value: params[:role] %>
        <% end %>
      </div>
    </div>
  </div>

  <!-- Users Content -->
  <%= turbo_frame_tag "users_content",
      data: { action: "turbo:frame-load->search#searchComplete" } do %>
    <%= render "users_list", users: @users, pagy: @pagy %>
  <% end %>
</div>
