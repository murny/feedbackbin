<% content_for :title, t(".title") %>

<div class="container mx-auto max-w-6xl px-4 py-8">
  <div class="flex items-center justify-between mb-8">
    <div>
      <h1 class="text-2xl font-semibold tracking-tight"><%= t(".heading") %></h1>
      <p class="text-sm text-muted-foreground"><%= t(".description") %></p>
    </div>
    <div class="whitespace-nowrap">
      <%= link_to new_admin_invitation_path, class: "btn btn-primary" do %>
        <%= lucide_icon "user-plus", class: "mr-2 h-4 w-4" %>
        <%= t(".new_invitation") %>
      <% end %>
    </div>
  </div>

  <%# Pending Invitations %>
  <div class="mb-8">
    <div class="mb-4">
      <h2 class="text-lg font-medium flex items-center gap-2">
        <%= t(".pending_invitations") %>
        <span class="inline-flex items-center rounded-full px-2 py-1 text-xs font-medium ring-1 ring-inset bg-yellow-50 text-yellow-800 ring-yellow-600/20 dark:bg-yellow-400/10 dark:text-yellow-400 dark:ring-yellow-400/20">
          <%= @pending_invitations.count %>
        </span>
      </h2>
    </div>

    <% if @pending_invitations.any? %>
      <div class="card">
        <ul role="list" class="divide-y divide-gray-200 dark:divide-gray-700">
          <% @pending_invitations.each do |invitation| %>
            <li class="flex items-center justify-between gap-x-6 py-5 px-6">
              <div class="min-w-0 flex-1">
                <div class="flex items-start gap-x-3">
                  <div class="min-w-0 flex-auto">
                    <p class="text-sm font-semibold leading-6 text-foreground">
                      <%= invitation.email %>
                      <% if invitation.name.present? %>
                        <span class="text-muted-foreground font-normal">(<%= invitation.name %>)</span>
                      <% end %>
                    </p>
                    <div class="mt-1 flex flex-wrap items-center gap-x-2 gap-y-1 text-xs leading-5 text-muted-foreground">
                      <p>
                        <%= t(".invited_by") %> <%= invitation.invited_by.name %>
                      </p>
                      <svg viewBox="0 0 2 2" class="h-0.5 w-0.5 fill-current">
                        <circle cx="1" cy="1" r="1" />
                      </svg>
                      <p>
                        <%= time_ago_in_words(invitation.created_at) %> <%= t(".ago") %>
                      </p>
                      <svg viewBox="0 0 2 2" class="h-0.5 w-0.5 fill-current">
                        <circle cx="1" cy="1" r="1" />
                      </svg>
                      <p>
                        <%= t(".expires_in", time: distance_of_time_in_words(Time.current, invitation.expires_at)) %>
                      </p>
                    </div>
                  </div>
                </div>
              </div>
              <div class="flex flex-none items-center gap-x-2">
                <%= link_to admin_invitation_path(invitation),
                      class: "btn btn-sm btn-ghost text-destructive hover:text-destructive/80",
                      data: { "turbo-method": :delete, turbo_confirm: t(".cancel_confirm") } do %>
                  <%= lucide_icon "x", class: "h-4 w-4" %>
                  <span class="sr-only"><%= t(".cancel_invitation") %></span>
                <% end %>
              </div>
            </li>
          <% end %>
        </ul>
      </div>
    <% else %>
      <div class="card p-8 text-center">
        <%= lucide_icon "mail-check", class: "mx-auto h-12 w-12 text-muted-foreground" %>
        <h3 class="mt-4 text-lg font-semibold text-foreground"><%= t(".no_pending_title") %></h3>
        <p class="mt-2 text-sm text-muted-foreground"><%= t(".no_pending_description") %></p>
      </div>
    <% end %>
  </div>

  <%# Accepted Invitations %>
  <div>
    <div class="mb-4">
      <h2 class="text-lg font-medium flex items-center gap-2">
        <%= t(".accepted_invitations") %>
        <span class="inline-flex items-center rounded-full px-2 py-1 text-xs font-medium ring-1 ring-inset bg-green-50 text-green-700 ring-green-600/20 dark:bg-green-400/10 dark:text-green-400 dark:ring-green-400/30">
          <%= @accepted_invitations.count %>
        </span>
      </h2>
      <p class="text-xs text-muted-foreground"><%= t(".showing_recent_accepted") %></p>
    </div>

    <% if @accepted_invitations.any? %>
      <div class="card">
        <ul role="list" class="divide-y divide-gray-200 dark:divide-gray-700">
          <% @accepted_invitations.each do |invitation| %>
            <li class="flex items-center justify-between gap-x-6 py-5 px-6">
              <div class="min-w-0">
                <div class="flex items-start gap-x-3">
                  <div class="min-w-0 flex-auto">
                    <p class="text-sm font-semibold leading-6 text-foreground">
                      <%= invitation.email %>
                      <% if invitation.name.present? %>
                        <span class="text-muted-foreground font-normal">(<%= invitation.name %>)</span>
                      <% end %>
                    </p>
                    <div class="mt-1 flex flex-wrap items-center gap-x-2 gap-y-1 text-xs leading-5 text-muted-foreground">
                      <p>
                        <%= t(".invited_by") %> <%= invitation.invited_by.name %>
                      </p>
                      <svg viewBox="0 0 2 2" class="h-0.5 w-0.5 fill-current">
                        <circle cx="1" cy="1" r="1" />
                      </svg>
                      <p>
                        <%= t(".accepted_ago", time: time_ago_in_words(invitation.accepted_at)) %>
                      </p>
                      <% if invitation.accepted_by %>
                        <svg viewBox="0 0 2 2" class="h-0.5 w-0.5 fill-current">
                          <circle cx="1" cy="1" r="1" />
                        </svg>
                        <p>
                          <%= t(".accepted_by") %> @<%= invitation.accepted_by.username %>
                        </p>
                      <% end %>
                    </div>
                  </div>
                </div>
              </div>
              <div class="hidden sm:flex sm:flex-col sm:items-end">
                <span class="inline-flex items-center rounded-full px-2 py-1 text-xs font-medium ring-1 ring-inset bg-green-50 text-green-700 ring-green-600/20 dark:bg-green-400/10 dark:text-green-400 dark:ring-green-400/30">
                  <%= lucide_icon "check", class: "mr-1 h-3 w-3" %>
                  <%= t(".status.accepted") %>
                </span>
              </div>
            </li>
          <% end %>
        </ul>
      </div>
    <% else %>
      <div class="card p-8 text-center">
        <%= lucide_icon "user-check", class: "mx-auto h-12 w-12 text-muted-foreground" %>
        <h3 class="mt-4 text-lg font-semibold text-foreground"><%= t(".no_accepted_title") %></h3>
        <p class="mt-2 text-sm text-muted-foreground"><%= t(".no_accepted_description") %></p>
      </div>
    <% end %>
  </div>
</div>
