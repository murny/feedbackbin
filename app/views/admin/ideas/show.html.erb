<% content_for :title, @idea.title %>

<div class="flex flex-column gap-8">
  <div class="flex flex-column sm:flex-row sm:align-center sm:justify-space-between gap-4">
    <div class="flex flex-column gap-1">
      <h1 class="txt-xx-large font-weight-bold">
        <%= truncate(@idea.title, length: 60) %>
      </h1>
      <p class="txt-subtle">
        <%= t(".description") %>
      </p>
    </div>
    <%= render Elements::ButtonComponent.new(
      href: admin_ideas_path,
      variant: :outline
    ) do %>
      <%= t(".back_button") %>
    <% end %>
  </div>

  <%= render Elements::PanelComponent.new do |c| %>
    <% c.with_header(title: t(".idea_info_title")) %>
    <% c.with_body do %>
      <div class="flex flex-column gap-6">
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <div style="grid-column: span 2;">
          <h3 class="txt-large font-weight-bold margin-block-end"><%= @idea.title %></h3>

          <div class="flex align-center" style="gap: var(--space-4); margin-block-end: var(--space-4);">
            <%= render Elements::AvatarComponent.new(
              src: @idea.creator.avatar.attached? ? url_for(@idea.creator.avatar) : nil,
              alt: @idea.creator.name,
              size: :sm,
              fallback: @idea.creator.name[0, 2].upcase
            ) %>
            <div>
              <div class="font-weight-medium"><%= @idea.creator.name %></div>
              <div class="txt-small txt-subtle"><%= @idea.creator.identity.email_address %></div>
            </div>
          </div>

          <div class="flex flex-wrap" style="gap: var(--space-2); margin-block-end: var(--space-4);">
            <% if @idea.board %>
              <%= render Elements::BadgeComponent.new(variant: :secondary) do %>
                <%= @idea.board.name %>
              <% end %>
            <% end %>
            <%= render Elements::BadgeComponent.new(variant: :outline) do %>
              <%= @idea.status_name %>
            <% end %>
          </div>

          <div class="prose" style="max-inline-size: none;" data-controller="syntax-highlight">
            <%= @idea.description %>
          </div>
        </div>

        <div class="flex flex-column gap-6">
          <div>
            <h4 class="txt-small font-weight-medium" style="margin-block-end: var(--space-3);"><%= t(".engagement_title") %></h4>
            <div class="flex flex-column gap-3">
              <div class="flex align-center justify-space-between txt-small">
                <span class="txt-subtle"><%= t(".votes_label") %></span>
                <span class="font-weight-medium"><%= @idea.votes_count %></span>
              </div>
              <div class="flex align-center justify-space-between txt-small">
                <span class="txt-subtle"><%= t(".comments_label") %></span>
                <span class="font-weight-medium"><%= @idea.comments_count %></span>
              </div>
              <div class="flex align-center justify-space-between txt-small">
                <span class="txt-subtle"><%= t(".created_label") %></span>
                <span class="font-weight-medium"><%= time_ago_in_words(@idea.created_at) %> <%= t(".ago") %></span>
              </div>
            </div>
          </div>
        </div>
      </div>
      </div>
    <% end %>
  <% end %>

  <% if @recent_comments.any? %>
    <%= render Elements::PanelComponent.new do |c| %>
      <% c.with_header(title: t(".recent_comments_title")) %>
      <% c.with_body do %>
      <div class="flex flex-column gap-4">
        <% @recent_comments.each do |comment| %>
          <div class="flex align-start border border-radius" style="gap: var(--space-3); padding: var(--space-4);">
            <%= render Elements::AvatarComponent.new(
              src: comment.creator.avatar.attached? ? url_for(comment.creator.avatar) : nil,
              alt: comment.creator.name,
              size: :sm,
              fallback: comment.creator.name[0, 2].upcase
            ) %>
            <div class="min-width flex-1">
              <div class="flex align-center" style="gap: var(--space-2); margin-block-end: var(--space-2);">
                <div class="font-weight-medium"><%= comment.creator.name %></div>
                <div class="txt-small txt-subtle">
                  <%= time_ago_in_words(comment.created_at) %> <%= t(".ago") %>
                </div>
              </div>
              <div class="txt-small" data-controller="syntax-highlight">
                <%= comment.body %>
              </div>
            </div>
          </div>
        <% end %>
      </div>
      <% end %>
    <% end %>
  <% else %>
    <%= render Elements::PanelComponent.new do |c| %>
      <% c.with_header(title: t(".comments_title")) %>
      <% c.with_body do %>
      <div class="txt-align-center txt-subtle" style="padding-block: var(--space-8);">
        <%= t(".no_comments") %>
      </div>
      <% end %>
    <% end %>
  <% end %>
</div>
