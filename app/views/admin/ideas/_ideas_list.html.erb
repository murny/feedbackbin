<%# locals: (ideas:, pagy:) %>

<%= render Elements::CardComponent.new(class: "overflow-hidden") do |c| %>
  <% c.with_body(class: "unpad") do %>
    <div class="overflow-x">
    <table class="full-width txt-small">
      <thead class="border-bottom">
        <tr class="fill-shade">
          <th class="txt-align-start font-weight-semibold" style="padding-inline: var(--space-6); padding-block: var(--space-4);"><%= t(".idea_column") %></th>
          <th class="txt-align-start font-weight-semibold" style="padding-inline: var(--space-6); padding-block: var(--space-4);"><%= t(".creator_column") %></th>
          <th class="txt-align-start font-weight-semibold" style="padding-inline: var(--space-6); padding-block: var(--space-4);"><%= t(".engagement_column") %></th>
          <th class="txt-align-start font-weight-semibold" style="padding-inline: var(--space-6); padding-block: var(--space-4);"><%= t(".created_column") %></th>
          <th class="txt-align-center font-weight-semibold" style="padding-inline: var(--space-6); padding-block: var(--space-4);"><%= t(".actions_column") %></th>
        </tr>
      </thead>
      <tbody class="divide-y">
        <% if ideas.any? %>
          <% ideas.each do |idea| %>
            <tr>
              <td style="padding-inline: var(--space-6); padding-block: var(--space-4);">
                <div style="min-inline-size: 0; max-inline-size: 20rem;">
                  <div class="font-weight-medium overflow-ellipsis" style="margin-block-end: var(--space-1);">
                    <%= idea.title %>
                  </div>
                  <% if idea.board %>
                    <%= render Elements::BadgeComponent.new(variant: :secondary) do %>
                      <%= idea.board.name %>
                    <% end %>
                  <% end %>
                  <%= render Elements::BadgeComponent.new(
                    variant: :outline,
                    style: "margin-inline-start: var(--space-2);"
                  ) do %>
                    <%= idea.status_name %>
                  <% end %>
                </div>
              </td>
              <td style="padding-inline: var(--space-6); padding-block: var(--space-4);">
                <div class="flex align-center" style="gap: var(--space-3);">
                  <%= render Elements::AvatarComponent.new(
                    src: idea.creator.avatar.attached? ? url_for(idea.creator.avatar) : nil,
                    alt: idea.creator.name,
                    size: :sm,
                    fallback: idea.creator.name[0, 2].upcase
                  ) %>
                  <div style="min-inline-size: 0;">
                    <div class="font-weight-medium overflow-ellipsis">
                      <%= idea.creator.name %>
                    </div>
                    <div class="txt-x-small txt-subtle overflow-ellipsis">
                      <%= idea.creator.identity.email_address %>
                    </div>
                  </div>
                </div>
              </td>
              <td style="padding-inline: var(--space-6); padding-block: var(--space-4);">
                <div class="flex align-center txt-x-small txt-subtle" style="gap: var(--space-4);">
                  <div class="flex align-center" style="gap: var(--space-1);">
                    <%= lucide_icon "heart", class: "size-3" %>
                    <span><%= idea.votes_count %></span>
                  </div>
                  <div class="flex align-center" style="gap: var(--space-1);">
                    <%= lucide_icon "message-square", class: "size-3" %>
                    <span><%= idea.comments_count %></span>
                  </div>
                </div>
              </td>
              <td class="txt-subtle" style="padding-inline: var(--space-6); padding-block: var(--space-4);">
                <div class="txt-small">
                  <%= idea.created_at.strftime("%b %d, %Y") %>
                </div>
                <div class="txt-x-small">
                  <%= time_ago_in_words(idea.created_at) %> <%= t(".ago") %>
                </div>
              </td>
              <td class="txt-align-center" style="padding-inline: var(--space-6); padding-block: var(--space-4);">
                <%= render Elements::ButtonComponent.new(
                  href: admin_idea_path(idea),
                  variant: :outline,
                  size: :sm,
                  data: { turbo_frame: "_top" }
                ) do %>
                  <%= t(".view_button") %>
                <% end %>
              </td>
            </tr>
          <% end %>
        <% else %>
          <tr>
            <td colspan="5" class="txt-align-center" style="padding-inline: var(--space-6); padding-block: var(--space-12);">
              <div class="center size-12 fill-shade flex align-center justify-center" style="margin-block-end: var(--space-4); border-radius: 9999px;">
                <%= lucide_icon "message-square", class: "size-6 txt-subtle" %>
              </div>
              <h3 class="txt-small font-weight-medium" style="margin-block-end: var(--space-2);"><%= t(".no_ideas_title") %></h3>
              <p class="txt-small txt-subtle">
                <% if params[:search].present? %>
                  <%= t(".no_ideas_search") %>
                <% else %>
                  <%= t(".no_ideas_empty") %>
                <% end %>
              </p>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
    </div>
  <% end %>
<% end %>

<div style="margin-block-start: var(--space-8);">
  <%= tag.div id: ("ideas" if first_page?(pagy.last)), class: "flex flex-column", style: "gap: var(--space-4);" do %>
    <div class="txt-align-center txt-small txt-subtle">
      <%== pagy.info_tag %>
    </div>
    <% if pagy.last > 1 %>
      <div class="flex justify-center">
        <%== pagy.series_nav(link_extra: 'data-turbo-frame="ideas_content"') %>
      </div>
    <% end %>
  <% end %>
</div>
